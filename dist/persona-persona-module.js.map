{"version":3,"sources":["webpack:///./src/app/servicios/persona.service.ts"],"names":[],"mappings":"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","file":"persona-persona-module.js","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { AngularFirestore, AngularFirestoreCollection, AngularFirestoreDocument } from 'angularfire2/firestore';\r\nimport { Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { query } from '../../../node_modules/@angular/core/src/render3/query';\r\nimport { AngularFireAuth } from 'angularfire2/auth';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PersonaService {\r\n\r\n  private personasCollection: AngularFirestoreCollection;\r\n  private empresa: AngularFirestoreDocument;\r\n  private personaDoc: AngularFirestore\r\n  personas: Observable<any[]>;\r\n  persona: Observable<any[]>;\r\n\r\n\r\n\r\n  constructor(private readonly afs: AngularFirestore, private afAuth: AngularFireAuth) {\r\n    this.personasCollection = afs.collection('persona');\r\n    this.empresa = this.afs.doc(localStorage.getItem('empresa'));\r\n\r\n  }\r\n\r\n  crearPersona(persona) {\r\n    const id = this.afs.createId();\r\n    return this.empresa.collection('personas').doc(id).set(persona);\r\n  }\r\n\r\n  comprobar(valor, campo){\r\n    this.empresa = this.afs.doc(localStorage.getItem('empresa'));\r\n\r\n    return this.empresa.collection('personas', query=>query.where(valor, '==', campo)).stateChanges()\r\n  }\r\n\r\n  modificarPersona(id, persona) {\r\n    return this.empresa.collection('personas').doc(id).update(persona);\r\n  }\r\n\r\n  eliminarPersona(idPersona) {\r\n    return this.empresa.collection('personas').doc(idPersona).delete()\r\n  }\r\n\r\n  obtenerPersonas() {\r\n    this.empresa = this.afs.doc(localStorage.getItem('empresa'));\r\n    return this.empresa.collection('personas', query=>query.orderBy('nombre')).snapshotChanges().pipe(\r\n      map(actions => actions.map(a => {\r\n        const data = a.payload.doc.data() as any;\r\n        const id = a.payload.doc.id;\r\n        return { id, data };\r\n      }))\r\n    );\r\n  }\r\n\r\n  obtenerUsuarios() {\r\n    this.empresa = this.afs.doc(localStorage.getItem('empresa'));\r\n    return this.empresa.collection('personas', query => query.where('empleado', '==', true)).snapshotChanges().pipe(\r\n      map(actions => actions.map(a => {\r\n        const data = a.payload.doc.data() as any;\r\n        const id = a.payload.doc.id;\r\n        return { id, data };\r\n      }))\r\n    );\r\n  }\r\n\r\n  obtenerClientes() {\r\n    this.empresa = this.afs.doc(localStorage.getItem('empresa'));\r\n    return this.empresa.collection('personas', query => query.where('cliente', '==', true)).snapshotChanges().pipe(\r\n      map(actions => actions.map(a => {\r\n        const data = a.payload.doc.data() as any;\r\n        const id = a.payload.doc.id;\r\n        return { id, data };\r\n      }))\r\n    );\r\n  }\r\n\r\n  obtenerVehiculos(uid) {\r\n    const userRef = this.afs.collection('personas').doc(uid)\r\n    return this.empresa.collection('vehiculos', query => query.where('dueno', '==', userRef.ref)).snapshotChanges().pipe(\r\n      map(actions => actions.map(a => {\r\n        const data = a.payload.doc.data() as any;\r\n        const id = a.payload.doc.id;\r\n        return { id, data };\r\n      }))\r\n    );\r\n  }\r\n\r\n  obtenerUnaPersona(id) {\r\n    return this.empresa.collection('personas').doc(id).valueChanges()\r\n  }\r\n\r\n  obtenerUsuario(){\r\n    return this.afAuth.user\r\n  }\r\n\r\n  obtenerEmpresa(){\r\n    this.empresa = this.afs.doc(localStorage.getItem('empresa'));\r\n    return this.empresa\r\n  }\r\n  \r\n\r\n  editarNumeracionInicial(otInicio){\r\n    this.empresa = this.afs.doc(localStorage.getItem('empresa'));\r\n    return this.empresa.update({otInicio: otInicio})\r\n  }\r\n\r\n  \r\n}\r\n"],"sourceRoot":""}